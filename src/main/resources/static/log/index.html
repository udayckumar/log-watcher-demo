<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Live Log Viewer</title>
    <style>
        body { font-family: monospace; background:#0f1720; color:#e6eef2; margin:0; padding:18px; }
        #box { max-width:1000px; margin:0 auto; }
        #log { background:#010409; padding:12px; border-radius:6px; height:70vh; overflow:auto; box-shadow: 0 6px 20px rgba(0,0,0,0.6); border: 1px solid #1f2a37;}
        .line { padding:2px 0; white-space:pre-wrap; }
        .meta { color:#9aa6b2; margin-bottom:8px; }
        #status { font-size:0.9em; color:#9aa6b2; margin-bottom:8px; }
    </style>
</head>
<body>
<div id="box">
    <h2>Live Log Viewer</h2>
    <div class="meta">WebSocket path: <strong>/log-socket</strong>. Shows last lines on connect and streams new lines.
    </div>
    <div id="status">Connecting...</div>
    <div id="log"></div>
</div>

<script>
    const logEl = document.getElementById('log');
    const statusEl = document.getElementById('status');

    function appendLine(text) {
      const d = document.createElement('div');
      d.className = 'line';
      d.textContent = text;
      logEl.appendChild(d);
      // auto-scroll
      logEl.scrollTop = logEl.scrollHeight;
      // limit
      if (logEl.childElementCount > 5000) {
        logEl.removeChild(logEl.firstChild);
      }
    }

    function connect() {
      const scheme = location.protocol === 'https:' ? 'wss' : 'ws';
      const host = location.host;
      const ws = new WebSocket(`${scheme}://${host}/log-socket`);

      ws.onopen = function() {
        statusEl.textContent = 'Connected';
        console.info('WS open');
      };

      ws.onmessage = function(ev) {
        appendLine(ev.data);
      };

      ws.onclose = function() {
        statusEl.textContent = 'Disconnected. Reconnecting in 1s...';
        setTimeout(connect, 1000);
      };

      ws.onerror = function(e) {
        console.error('WS error', e);
        ws.close();
      };
    }

    // connect once
    connect();
</script>
</body>
</html>
